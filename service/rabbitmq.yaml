service:
  name: rabbitmq
  ports:
    - rabbitmq_port
  containers:
    - name: rabbitmq
      image: rabbitmq
      probes:
        readiness: "true"
        liveness: "true"
      volumes:
      - name: rabbitmq-logs
        path: "/var/log/ccp/rabbitmq"
        type: host
        readOnly: False
      pre:
        - name: chown-logs-dir
          command: "sudo /bin/chown rabbitmq: /var/log/ccp/rabbitmq"
      daemon:
        files:
          - rabbitmq-conf
          - rabbitmq-env
          - erlang-cookie
        command: rabbitmq-server
files:
  rabbitmq-conf:
    path: /etc/rabbitmq/rabbitmq.config
    content: rabbitmq.config.j2
  rabbitmq-env:
    path: /etc/rabbitmq/rabbitmq-env.conf
    content: rabbitmq-env.conf.j2
  erlang-cookie:
    path: /var/lib/rabbitmq/.erlang.cookie
    content: erlang.cookie
    perm: "400"

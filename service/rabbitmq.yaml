service:
  name: rabbitmq
  ports:
    - rabbitmq_port
  node-selector:
    openstack-controller: "true"
  containers:
    - name: rabbitmq
      image: rabbitmq
      probes:
        readiness: "true"
        liveness: "true"
      daemon:
        dependencies:
          - etcd
        files:
          - rabbitmq-conf
          - erlang-cookie
        command: /usr/lib/rabbitmq/bin/rabbitmq-server
files:
  rabbitmq-conf:
    path: /etc/rabbitmq/rabbitmq.config
    content: rabbitmq.config.j2
  erlang-cookie:
    path: /var/lib/rabbitmq/.erlang.cookie
    content: erlang.cookie
    perm: "400"

service:
  name: rabbitmq
  ports:
    - rabbitmq_port
  node-selector:
    openstack-controller: "true"
  containers:
    - name: rabbitmq
      image: rabbitmq
      probes:
        readiness: "true"
        liveness: "true"
      daemon:
        dependencies:
          - etcd
        files:
          - rabbitmq-conf
          - erlang-cookie
          - rabbitmq-env-conf
          - enabled-plugins
        command: /start-rabbit
files:
  rabbitmq-conf:
    path: /etc/rabbitmq/rabbitmq.config
    content: rabbitmq.config.j2
  rabbitmq-env-conf:
    path: /etc/rabbitmq/rabbitmq-env.conf
    content: rabbitmq-env.conf.j2
  enabled-plugins:
    path: /etc/rabbitmq/enabled_plugins
    content: enabled_plugins.j2
  erlang-cookie:
    path: /var/lib/rabbitmq/.erlang.cookie
    content: erlang.cookie.j2
    perm: "400"
